---
title: æ–‡æœ¬å‘é‡åŒ–ï¼ˆEmbeddingï¼‰
sidebarTitle: Embedding API
description: å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºï¼Œç”¨äºè¯­ä¹‰æœç´¢ã€æ–‡æœ¬åˆ†ç±»ã€ç›¸ä¼¼åº¦è®¡ç®—ç­‰åœºæ™¯
icon: "brackets-square"
---

## åŠŸèƒ½æ¦‚è¿°

æ–‡æœ¬åµŒå…¥ï¼ˆText Embeddingï¼‰API å¯ä»¥å°†æ–‡æœ¬è½¬æ¢ä¸ºé«˜ç»´å‘é‡è¡¨ç¤ºï¼Œæ•æ‰æ–‡æœ¬çš„è¯­ä¹‰ä¿¡æ¯ã€‚è¿™äº›å‘é‡å¯ç”¨äºï¼š

- **è¯­ä¹‰æœç´¢**ï¼šåŸºäºå«ä¹‰è€Œéå…³é”®è¯åŒ¹é…è¿›è¡Œæœç´¢
- **æ–‡æœ¬åˆ†ç±»**ï¼šå°†æ–‡æœ¬è‡ªåŠ¨å½’ç±»åˆ°é¢„å®šä¹‰ç±»åˆ«
- **ç›¸ä¼¼åº¦è®¡ç®—**ï¼šè®¡ç®—ä¸¤æ®µæ–‡æœ¬çš„è¯­ä¹‰ç›¸ä¼¼ç¨‹åº¦
- **èšç±»åˆ†æ**ï¼šå°†ç›¸ä¼¼æ–‡æœ¬è‡ªåŠ¨åˆ†ç»„
- **æ¨èç³»ç»Ÿ**ï¼šåŸºäºå†…å®¹ç›¸ä¼¼åº¦è¿›è¡Œæ¨è
- **RAG åº”ç”¨**ï¼šæ£€ç´¢å¢å¼ºç”Ÿæˆçš„æ ¸å¿ƒèƒ½åŠ›

<Info>
  è€å¼ API æ”¯æŒ OpenAIã€Cohereã€BGE ç­‰å¤šç§ Embedding æ¨¡å‹ï¼Œå…¼å®¹ OpenAI SDKã€‚
</Info>

## å¿«é€Ÿå¼€å§‹

### åŸºç¡€ç¤ºä¾‹

```python
from openai import OpenAI

client = OpenAI(
    api_key="sk-ä½ çš„è€å¼ APIå¯†é’¥",
    base_url="https://api.laozhang.ai/v1"
)

response = client.embeddings.create(
    model="text-embedding-3-small",
    input="äººå·¥æ™ºèƒ½æ­£åœ¨æ”¹å˜ä¸–ç•Œ"
)

# è·å–å‘é‡
embedding = response.data[0].embedding
print(f"å‘é‡ç»´åº¦: {len(embedding)}")
print(f"å‰5ä¸ªå€¼: {embedding[:5]}")
```

### æ‰¹é‡å¤„ç†

ä¸€æ¬¡è¯·æ±‚å¤„ç†å¤šä¸ªæ–‡æœ¬ï¼š

```python
texts = [
    "æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯",
    "æ·±åº¦å­¦ä¹ ä½¿ç”¨ç¥ç»ç½‘ç»œè¿›è¡Œå­¦ä¹ ",
    "è‡ªç„¶è¯­è¨€å¤„ç†è®©æœºå™¨ç†è§£äººç±»è¯­è¨€"
]

response = client.embeddings.create(
    model="text-embedding-3-small",
    input=texts
)

# è·å–æ‰€æœ‰å‘é‡
embeddings = [item.embedding for item in response.data]
print(f"å¤„ç†äº† {len(embeddings)} ä¸ªæ–‡æœ¬")
```

## æ”¯æŒçš„æ¨¡å‹

| æ¨¡å‹ | ç»´åº¦ | ç‰¹ç‚¹ | æ¨èåœºæ™¯ |
|------|------|------|----------|
| `text-embedding-3-small` | 1536 | æ€§ä»·æ¯”é«˜ï¼Œé€Ÿåº¦å¿« | é€šç”¨åœºæ™¯ |
| `text-embedding-3-large` | 3072 | æ•ˆæœæœ€å¥½ï¼Œç»´åº¦é«˜ | é«˜ç²¾åº¦éœ€æ±‚ |
| `text-embedding-ada-002` | 1536 | ç»å…¸æ¨¡å‹ï¼Œå…¼å®¹æ€§å¥½ | å·²æœ‰ç³»ç»Ÿè¿ç§» |

<Tip>
  ğŸ’¡ **é€‰æ‹©å»ºè®®**ï¼š
  - å¤§å¤šæ•°åœºæ™¯ä½¿ç”¨ `text-embedding-3-small` å³å¯
  - å¯¹ç²¾åº¦è¦æ±‚æé«˜æ—¶ä½¿ç”¨ `text-embedding-3-large`
</Tip>

## æ ¸å¿ƒå‚æ•°

### modelï¼ˆå¿…å¡«ï¼‰

æŒ‡å®š Embedding æ¨¡å‹ï¼š

```python
model="text-embedding-3-small"   # æ¨èï¼Œæ€§ä»·æ¯”é«˜
model="text-embedding-3-large"   # é«˜ç²¾åº¦
model="text-embedding-ada-002"   # ç»å…¸æ¨¡å‹
```

### inputï¼ˆå¿…å¡«ï¼‰

è¦è½¬æ¢çš„æ–‡æœ¬ï¼Œæ”¯æŒå•ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ï¼š

```python
# å•ä¸ªæ–‡æœ¬
input="è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡æœ¬"

# å¤šä¸ªæ–‡æœ¬ï¼ˆæ‰¹é‡å¤„ç†ï¼‰
input=["æ–‡æœ¬1", "æ–‡æœ¬2", "æ–‡æœ¬3"]
```

### dimensionsï¼ˆå¯é€‰ï¼‰

æŒ‡å®šè¾“å‡ºå‘é‡ç»´åº¦ï¼ˆä»… v3 æ¨¡å‹æ”¯æŒï¼‰ï¼š

```python
response = client.embeddings.create(
    model="text-embedding-3-small",
    input="æµ‹è¯•æ–‡æœ¬",
    dimensions=512  # é™ä½ç»´åº¦ï¼Œå‡å°‘å­˜å‚¨
)
```

<Note>
  é™ä½ç»´åº¦å¯ä»¥å‡å°‘å­˜å‚¨ç©ºé—´å’Œè®¡ç®—æˆæœ¬ï¼Œä½†å¯èƒ½ç•¥å¾®å½±å“æ•ˆæœã€‚
</Note>

## å®ç”¨ç¤ºä¾‹

### 1. è®¡ç®—æ–‡æœ¬ç›¸ä¼¼åº¦

```python
import numpy as np
from openai import OpenAI

client = OpenAI(
    api_key="sk-ä½ çš„è€å¼ APIå¯†é’¥",
    base_url="https://api.laozhang.ai/v1"
)

def get_embedding(text):
    """è·å–æ–‡æœ¬çš„å‘é‡è¡¨ç¤º"""
    response = client.embeddings.create(
        model="text-embedding-3-small",
        input=text
    )
    return response.data[0].embedding

def cosine_similarity(a, b):
    """è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦"""
    return np.dot(a, b) / (np.linalg.norm(a) * np.linalg.norm(b))

# è®¡ç®—ä¸¤æ®µæ–‡æœ¬çš„ç›¸ä¼¼åº¦
text1 = "ä»Šå¤©å¤©æ°”å¾ˆå¥½"
text2 = "ä»Šå¤©é˜³å…‰æ˜åªš"
text3 = "æˆ‘å–œæ¬¢åƒè‹¹æœ"

emb1 = get_embedding(text1)
emb2 = get_embedding(text2)
emb3 = get_embedding(text3)

print(f"æ–‡æœ¬1å’Œæ–‡æœ¬2çš„ç›¸ä¼¼åº¦: {cosine_similarity(emb1, emb2):.4f}")
print(f"æ–‡æœ¬1å’Œæ–‡æœ¬3çš„ç›¸ä¼¼åº¦: {cosine_similarity(emb1, emb3):.4f}")
```

### 2. è¯­ä¹‰æœç´¢

```python
import numpy as np
from openai import OpenAI

client = OpenAI(
    api_key="sk-ä½ çš„è€å¼ APIå¯†é’¥",
    base_url="https://api.laozhang.ai/v1"
)

# æ–‡æ¡£åº“
documents = [
    "Python æ˜¯ä¸€ç§è§£é‡Šå‹ç¼–ç¨‹è¯­è¨€",
    "JavaScript å¸¸ç”¨äºç½‘é¡µå¼€å‘",
    "æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯",
    "æ•°æ®åº“ç”¨äºå­˜å‚¨å’Œç®¡ç†æ•°æ®",
    "æ·±åº¦å­¦ä¹ ä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œ"
]

def get_embeddings(texts):
    """æ‰¹é‡è·å–å‘é‡"""
    response = client.embeddings.create(
        model="text-embedding-3-small",
        input=texts
    )
    return [item.embedding for item in response.data]

def semantic_search(query, docs, doc_embeddings, top_k=3):
    """è¯­ä¹‰æœç´¢"""
    query_embedding = get_embeddings([query])[0]
    
    # è®¡ç®—ç›¸ä¼¼åº¦
    similarities = []
    for i, doc_emb in enumerate(doc_embeddings):
        sim = np.dot(query_embedding, doc_emb) / (
            np.linalg.norm(query_embedding) * np.linalg.norm(doc_emb)
        )
        similarities.append((i, sim))
    
    # æ’åºè¿”å›æœ€ç›¸ä¼¼çš„æ–‡æ¡£
    similarities.sort(key=lambda x: x[1], reverse=True)
    return [(docs[i], sim) for i, sim in similarities[:top_k]]

# é¢„è®¡ç®—æ–‡æ¡£å‘é‡
doc_embeddings = get_embeddings(documents)

# æœç´¢
query = "ä»€ä¹ˆæ˜¯AIï¼Ÿ"
results = semantic_search(query, documents, doc_embeddings)

print(f"æŸ¥è¯¢: {query}")
print("æœç´¢ç»“æœ:")
for doc, score in results:
    print(f"  [{score:.4f}] {doc}")
```

### 3. æ–‡æœ¬åˆ†ç±»

```python
import numpy as np
from openai import OpenAI

client = OpenAI(
    api_key="sk-ä½ çš„è€å¼ APIå¯†é’¥",
    base_url="https://api.laozhang.ai/v1"
)

# ç±»åˆ«ç¤ºä¾‹
categories = {
    "æŠ€æœ¯": ["ç¼–ç¨‹è¯­è¨€", "è½¯ä»¶å¼€å‘", "äººå·¥æ™ºèƒ½"],
    "ä½“è‚²": ["è¶³çƒæ¯”èµ›", "ç¯®çƒè¿åŠ¨", "å¥¥è¿ä¼š"],
    "ç¾é£Ÿ": ["ä¸­é¤çƒ¹é¥ª", "è¥¿é¤æ–™ç†", "ç”œç‚¹åˆ¶ä½œ"]
}

def classify_text(text, categories):
    """åŸºäºå‘é‡ç›¸ä¼¼åº¦è¿›è¡Œåˆ†ç±»"""
    text_emb = get_embedding(text)
    
    best_category = None
    best_score = -1
    
    for category, examples in categories.items():
        # è·å–ç±»åˆ«ç¤ºä¾‹çš„å¹³å‡å‘é‡
        example_embs = get_embeddings(examples)
        avg_emb = np.mean(example_embs, axis=0)
        
        # è®¡ç®—ç›¸ä¼¼åº¦
        score = np.dot(text_emb, avg_emb) / (
            np.linalg.norm(text_emb) * np.linalg.norm(avg_emb)
        )
        
        if score > best_score:
            best_score = score
            best_category = category
    
    return best_category, best_score

# æµ‹è¯•åˆ†ç±»
test_texts = [
    "Pythonç¼–ç¨‹å…¥é—¨æ•™ç¨‹",
    "ä¸–ç•Œæ¯è¶³çƒèµ›ç²¾å½©å›é¡¾",
    "å¦‚ä½•åšä¸€é“ç¾å‘³çš„çº¢çƒ§è‚‰"
]

for text in test_texts:
    category, score = classify_text(text, categories)
    print(f"'{text}' -> {category} (ç½®ä¿¡åº¦: {score:.4f})")
```

## ä¸å‘é‡æ•°æ®åº“é›†æˆ

### Pinecone é›†æˆ

```python
import pinecone
from openai import OpenAI

# åˆå§‹åŒ–
client = OpenAI(api_key="sk-xxx", base_url="https://api.laozhang.ai/v1")
pinecone.init(api_key="pinecone-api-key")
index = pinecone.Index("my-index")

# å­˜å‚¨å‘é‡
def store_document(doc_id, text):
    embedding = client.embeddings.create(
        model="text-embedding-3-small",
        input=text
    ).data[0].embedding
    
    index.upsert([(doc_id, embedding, {"text": text})])

# æœç´¢
def search(query, top_k=5):
    query_embedding = client.embeddings.create(
        model="text-embedding-3-small",
        input=query
    ).data[0].embedding
    
    results = index.query(query_embedding, top_k=top_k, include_metadata=True)
    return results
```

### Chroma é›†æˆ

```python
import chromadb
from openai import OpenAI

client = OpenAI(api_key="sk-xxx", base_url="https://api.laozhang.ai/v1")
chroma_client = chromadb.Client()
collection = chroma_client.create_collection("my_collection")

# è‡ªå®šä¹‰ Embedding å‡½æ•°
def get_embedding(texts):
    response = client.embeddings.create(
        model="text-embedding-3-small",
        input=texts
    )
    return [item.embedding for item in response.data]

# æ·»åŠ æ–‡æ¡£
documents = ["æ–‡æ¡£1", "æ–‡æ¡£2", "æ–‡æ¡£3"]
embeddings = get_embedding(documents)
collection.add(
    embeddings=embeddings,
    documents=documents,
    ids=["id1", "id2", "id3"]
)

# æœç´¢
query_embedding = get_embedding(["æœç´¢æŸ¥è¯¢"])[0]
results = collection.query(query_embeddings=[query_embedding], n_results=3)
```

## æœ€ä½³å®è·µ

### 1. æ‰¹é‡å¤„ç†

```python
# âŒ ä¸å¥½ï¼šé€ä¸ªè¯·æ±‚
for text in texts:
    embedding = get_embedding(text)

# âœ… å¥½ï¼šæ‰¹é‡è¯·æ±‚
embeddings = get_embeddings(texts)  # ä¸€æ¬¡è¯·æ±‚å¤„ç†æ‰€æœ‰æ–‡æœ¬
```

### 2. æ–‡æœ¬é¢„å¤„ç†

```python
def preprocess_text(text):
    """é¢„å¤„ç†æ–‡æœ¬"""
    # å»é™¤å¤šä½™ç©ºç™½
    text = " ".join(text.split())
    # æˆªæ–­è¿‡é•¿æ–‡æœ¬
    if len(text) > 8000:
        text = text[:8000]
    return text
```

### 3. ç¼“å­˜å‘é‡

```python
import hashlib
import json

embedding_cache = {}

def get_embedding_cached(text):
    """å¸¦ç¼“å­˜çš„å‘é‡è·å–"""
    cache_key = hashlib.md5(text.encode()).hexdigest()
    
    if cache_key in embedding_cache:
        return embedding_cache[cache_key]
    
    embedding = get_embedding(text)
    embedding_cache[cache_key] = embedding
    return embedding
```

## å®šä»·è¯´æ˜

| æ¨¡å‹ | ä»·æ ¼ |
|------|------|
| `text-embedding-3-small` | $0.00002 / 1K tokens |
| `text-embedding-3-large` | $0.00013 / 1K tokens |
| `text-embedding-ada-002` | $0.00010 / 1K tokens |

<Tip>
  è€å¼ API æä¾›æ›´ä¼˜æƒ çš„ä»·æ ¼ï¼Œè¯¦è§ [å®šä»·é¡µé¢](/pricing)ã€‚
</Tip>

## å¸¸è§é—®é¢˜

<AccordionGroup>
  <Accordion title="å‘é‡ç»´åº¦å¤šå°‘åˆé€‚ï¼Ÿ">
    - é€šç”¨åœºæ™¯ï¼š1536 ç»´ï¼ˆé»˜è®¤ï¼‰è¶³å¤Ÿ
    - å­˜å‚¨å—é™ï¼šå¯é™åˆ° 512 æˆ– 256 ç»´
    - é«˜ç²¾åº¦éœ€æ±‚ï¼šä½¿ç”¨ 3072 ç»´çš„ large æ¨¡å‹
  </Accordion>

  <Accordion title="å•æ¬¡æœ€å¤šå¤„ç†å¤šå°‘æ–‡æœ¬ï¼Ÿ">
    å»ºè®®å•æ¬¡è¯·æ±‚ä¸è¶…è¿‡ 2000 ä¸ªæ–‡æœ¬ï¼Œè¿‡å¤šå¯èƒ½è¶…æ—¶ã€‚
  </Accordion>

  <Accordion title="æ–‡æœ¬é•¿åº¦é™åˆ¶æ˜¯å¤šå°‘ï¼Ÿ">
    æœ€å¤§ 8192 tokensï¼Œè¶…è¿‡ä¼šè¢«æˆªæ–­ã€‚
  </Accordion>
</AccordionGroup>

## ç›¸å…³æ–‡æ¡£

<CardGroup cols={2}>
  <Card title="æ–‡æœ¬ç”Ÿæˆ" icon="message-square" href="/api-capabilities/text-generation">
    ä½¿ç”¨ Chat API è¿›è¡Œå¯¹è¯
  </Card>
  <Card title="LangChain é›†æˆ" icon="link" href="/scenarios/engineering/langchain">
    åœ¨ LangChain ä¸­ä½¿ç”¨ Embedding
  </Card>
  <Card title="æ¨¡å‹ä¿¡æ¯" icon="database" href="/api-capabilities/model-info">
    æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„æ¨¡å‹
  </Card>
  <Card title="Dify é…ç½®" icon="puzzle" href="/scenarios/engineering/dify">
    åœ¨ Dify ä¸­é…ç½®å‘é‡æ¨¡å‹
  </Card>
</CardGroup>

